<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Арканоид - PERVUSHIN.EVENT</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
      background: #000000;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #ffd700;
      touch-action: manipulation;
    }
    
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
    }
    
    .game-container {
      position: relative;
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }
    
    .game-header {
      text-align: center;
      margin-bottom: 10px;
      width: 100%;
    }
    
    .game-title {
      font-size: 1.8rem;
      margin-bottom: 8px;
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      font-weight: bold;
      letter-spacing: 1px;
    }
    
    .game-stats {
      display: flex;
      justify-content: space-between;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 8px;
      border: 1px solid #ffd700;
      font-size: 0.9rem;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }
    
    .stat-value {
      color: #ffd700;
      font-weight: bold;
    }
    
    .bonus-active {
      color: #00ff00 !important;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    canvas {
      display: block;
      width: 100%;
      height: auto;
      border: 2px solid #ffd700;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
      background: #000000;
      touch-action: none;
    }
    
    .countdown {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 20;
      border-radius: 8px;
      font-size: 6rem;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
      animation: countdownPulse 1s infinite;
    }
    
    @keyframes countdownPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .game-over, .thanks-screen {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      border: 2px solid #ffd700;
      width: 80%;
      max-width: 300px;
      display: none;
      z-index: 10;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }
    
    .thanks-screen {
      border-color: #ffd700;
    }
    
    .game-over h2, .thanks-screen h2 {
      margin-bottom: 15px;
      font-size: 1.5rem;
      color: #ffd700;
    }
    
    .thanks-message {
      font-size: 1.1rem;
      margin-bottom: 15px;
      line-height: 1.4;
    }
    
    .bonus-earned {
      font-size: 1.3rem;
      color: #ffd700;
      font-weight: bold;
      margin: 15px 0;
      animation: glow 2s infinite;
    }
    
    @keyframes glow {
      0% { text-shadow: 0 0 5px #ffd700; }
      50% { text-shadow: 0 0 20px #ffd700, 0 0 30px #ffd700; }
      100% { text-shadow: 0 0 5px #ffd700; }
    }
    
    .btn {
      background: #ffd700;
      color: #000;
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
      width: 100%;
      transition: all 0.3s;
    }
    
    .btn:active {
      background: #ffed4e;
      transform: scale(0.98);
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="game-header">
      <h1 class="game-title">PERVUSHIN.EVENT</h1>
      <div class="game-stats">
        <div class="stat">ГОНОРАР: <span id="score">0</span></div>
        <div class="stat">Уровень: <span id="level">1</span></div>
        <div class="stat">СЕЗОН: <span id="lives">3</span></div>
        <div class="stat">БОНУС: <span id="bonus">НЕТ</span></div>
      </div>
    </div>
    
    <canvas id="game"></canvas>
    
    <div class="countdown" id="countdown">5</div>
    
    <div class="game-over" id="gameOver">
      <h2>ИГРА ОКОНЧЕНА</h2>
      <p>Ваш ГОНОРАР: <span id="finalScore">0</span></p>
      <button class="btn" id="restartBtn">Играть снова</button>
    </div>
    
    <div class="thanks-screen" id="thanksScreen">
      <h2>БЛАГОДАРНОСТЬ</h2>
      <div class="thanks-message">
        Евгений благодарит вас за помощь в организации мероприятия!
      </div>
      <div class="bonus-earned">
        +<span id="bonusAmount">0</span> ГОНОРАРА
      </div>
      <button class="btn" id="continueBtn">Продолжить</button>
    </div>
  </div>

  <script>
    // Инициализация элементов
    const canvas = document.getElementById('game');
    const context = canvas.getContext('2d');
    const countdownElement = document.getElementById('countdown');
    const gameOverScreen = document.getElementById('gameOver');
    const thanksScreen = document.getElementById('thanksScreen');
    
    // Игровые переменные
    let gameStarted = false;
    let gameRunning = false;
    let score = 0;
    let level = 1;
    let lives = 3;
    let bonusActive = false;
    let bonusMultiplier = 1;
    let countdown = 5;
    let ballLost = false;
    
    // Размеры
    const brickWidth = 25;
    const brickHeight = 12;
    const brickGap = 2;
    const wallSize = 12;
    const bricksPerRow = 13;
    const totalRows = 16;
    
    // НОВАЯ ШКАЛА ГОНОРАРОВ
    const brickRewards = {
      'A': 10000,  // АКСУ
      'P': 50000,  // ПВЛ
      'N': 80000,  // НСК
      'S': 100000, // СПБ
      'M': 150000  // МСК
    };
    
    // Уровни
    const levels = [
      // Уровень 1: 13x16 = 208 кирпичей
      Array(totalRows).fill().map((_, rowIndex) => 
        Array(bricksPerRow).fill().map((_, colIndex) => {
          // Распределение типов кирпичей по рядам
          if (rowIndex < 4) return 'M'; // МСК - 4 ряда
          if (rowIndex < 6) return 'S'; // СПБ - 2 ряда
          if (rowIndex < 8) return 'N'; // НСК - 2 ряда
          if (rowIndex < 11) return 'P'; // ПВЛ - 3 ряда
          return 'A'; // АКСУ - 5 рядов
        })
      )
    ];

    // Цвета кирпичей
    const brickColors = {
      'M': { color: '#FFFFFF', textColor: '#000000', city: 'МСК' },
      'S': { color: '#0000FF', textColor: '#FFFFFF', city: 'СПБ' },
      'N': { color: '#FF0000', textColor: '#FFFFFF', city: 'НСК' },
      'P': { color: '#0000FF', textColor: '#FFD700', city: 'ПВЛ' },
      'A': { color: '#0000FF', textColor: '#FFD700', city: 'АКСУ' }
    };

    // Игровые объекты
    let bricks = [];
    let bonuses = [];
    let particles = [];
    
    const paddle = {
      x: 0,
      y: 0,
      width: 80,
      height: 12,
      speed: 8
    };
    
    const ball = {
      x: 0,
      y: 0,
      width: 8,
      height: 8,
      dx: 0,
      dy: 0,
      speed: 5
    };

    // Функция вибрации
    function vibrate() {
      if (navigator.vibrate) {
        // Вибрация при столкновении с кирпичом
        navigator.vibrate(50);
      }
    }

    // Инициализация игры
    function initGame() {
      resizeCanvas();
      createLevel();
      resetBall();
      updateStats();
      
      // Запускаем отсчет
      startCountdown();
    }

    // Обратный отсчет
    function startCountdown() {
      const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          countdownElement.style.display = 'none';
          startGame();
        }
      }, 1000);
    }

    // Создание уровня
    function createLevel() {
      bricks = [];
      const levelData = levels[level - 1];
      
      for (let row = 0; row < levelData.length; row++) {
        for (let col = 0; col < levelData[row].length; col++) {
          const type = levelData[row][col];
          if (!type) continue;
          
          const brickInfo = brickColors[type];
          bricks.push({
            x: wallSize + (brickWidth + brickGap) * col,
            y: wallSize + (brickHeight + brickGap) * row,
            width: brickWidth,
            height: brickHeight,
            color: brickInfo.color,
            textColor: brickInfo.textColor,
            city: brickInfo.city,
            type: type,
            reward: brickRewards[type] // Добавляем награду за кирпич
          });
        }
      }
    }

    // Сброс мяча
    function resetBall() {
      ball.x = paddle.x + paddle.width / 2 - ball.width / 2;
      ball.y = paddle.y - ball.height - 5;
      ball.dx = 0;
      ball.dy = 0;
      ballLost = false;
    }

    // Запуск мяча
    function launchBall() {
      if (ball.dx === 0 && ball.dy === 0) {
        // Случайный угол запуска (от -60 до 60 градусов)
        const angle = (Math.random() * 120 - 60) * Math.PI / 180;
        ball.dx = Math.cos(angle) * ball.speed;
        ball.dy = Math.sin(angle) * ball.speed;
        
        // Гарантируем, что мяч летит вверх
        if (ball.dy > 0) ball.dy = -ball.dy;
      }
    }

    // Обновление статистики
    function updateStats() {
      document.getElementById('score').textContent = score.toLocaleString();
      document.getElementById('level').textContent = level;
      document.getElementById('lives').textContent = lives;
      document.getElementById('bonus').textContent = bonusActive ? 'x2 ГОНОРАР!' : 'НЕТ';
      if (bonusActive) {
        document.getElementById('bonus').classList.add('bonus-active');
      } else {
        document.getElementById('bonus').classList.remove('bonus-active');
      }
    }

    // Проверка столкновений
    function checkCollision(obj1, obj2) {
      return obj1.x < obj2.x + obj2.width &&
             obj1.x + obj1.width > obj2.x &&
             obj1.y < obj2.y + obj2.height &&
             obj1.y + obj1.height > obj2.y;
    }

    // Обработка касаний
    let touchX = 0;
    let isDragging = false;

    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      
      if (!gameStarted) return;
      
      const touch = e.touches[0];
      touchX = touch.clientX;
      isDragging = true;
    });

    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (!isDragging || !gameStarted) return;
      
      const touch = e.touches[0];
      const deltaX = touch.clientX - touchX;
      
      paddle.x += deltaX * 2;
      
      // Границы
      if (paddle.x < wallSize) paddle.x = wallSize;
      if (paddle.x + paddle.width > canvas.width - wallSize) {
        paddle.x = canvas.width - wallSize - paddle.width;
      }
      
      touchX = touch.clientX;
    });

    canvas.addEventListener('touchend', () => {
      isDragging = false;
    });

    // Запуск игры
    function startGame() {
      gameStarted = true;
      gameRunning = true;
      launchBall();
      gameLoop();
    }

    // Перезапуск после потери мяча
    function restartAfterBallLoss() {
      gameRunning = false;
      ballLost = true;
      countdown = 3;
      countdownElement.style.display = 'flex';
      countdownElement.textContent = countdown;
      
      const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          countdownElement.style.display = 'none';
          resetBall();
          gameRunning = true;
          launchBall();
          gameLoop();
        }
      }, 1000);
    }

    // Игровой цикл
    function gameLoop() {
      if (!gameRunning) return;
      
      update();
      render();
      requestAnimationFrame(gameLoop);
    }

    // Обновление игры
    function update() {
      // Движение мяча
      ball.x += ball.dx;
      ball.y += ball.dy;
      
      // Столкновение со стенами
      if (ball.x < wallSize) {
        ball.x = wallSize;
        ball.dx = Math.abs(ball.dx);
      } else if (ball.x + ball.width > canvas.width - wallSize) {
        ball.x = canvas.width - wallSize - ball.width;
        ball.dx = -Math.abs(ball.dx);
      }
      
      if (ball.y < wallSize) {
        ball.y = wallSize;
        ball.dy = Math.abs(ball.dy);
      }
      
      // Потеря мяча
      if (ball.y > canvas.height) {
        if (!ballLost) {
          lives--;
          updateStats();
          if (lives <= 0) {
            gameOver();
          } else {
            restartAfterBallLoss();
          }
        }
        return;
      }
      
      // Столкновение с платформой
      if (checkCollision(ball, paddle)) {
        // Вычисляем точку удара относительно центра платформы
        const hitPos = (ball.x + ball.width/2 - paddle.x) / paddle.width;
        
        // Нормализуем от -1 до 1
        const normalizedHitPos = hitPos * 2 - 1;
        
        // Угол отскока (от -75 до 75 градусов)
        const maxBounceAngle = 75 * Math.PI / 180;
        const bounceAngle = normalizedHitPos * maxBounceAngle;
        
        // Устанавливаем новое направление
        const speed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
        ball.dx = Math.sin(bounceAngle) * speed;
        ball.dy = -Math.abs(Math.cos(bounceAngle) * speed);
        
        // Корректируем позицию мяча
        ball.y = paddle.y - ball.height;
      }
      
      // Столкновение с кирпичами
      for (let i = bricks.length - 1; i >= 0; i--) {
        const brick = bricks[i];
        if (checkCollision(ball, brick)) {
          // ВИБРАЦИЯ при столкновении с кирпичом
          vibrate();
          
          // Бонус от СПБ
          if (brick.type === 'S' && Math.random() < 0.3) {
            bonuses.push({
              x: brick.x,
              y: brick.y,
              width: brickWidth,
              height: brickHeight,
              text: "АГЕНТСТВО",
              color: "#00FF00",
              speed: 2
            });
          }
          
          // Определяем сторону столкновения для правильного отскока
          const ballCenterX = ball.x + ball.width/2;
          const ballCenterY = ball.y + ball.height/2;
          const brickCenterX = brick.x + brick.width/2;
          const brickCenterY = brick.y + brick.height/2;
          
          const dx = ballCenterX - brickCenterX;
          const dy = ballCenterY - brickCenterY;
          const width = (ball.width + brick.width) / 2;
          const height = (ball.height + brick.height) / 2;
          const crossWidth = width * dy;
          const crossHeight = height * dx;
          
          if (Math.abs(dx) <= width && Math.abs(dy) <= height) {
            if (crossWidth > crossHeight) {
              // Столкновение сверху или снизу
              ball.dy = -ball.dy;
            } else {
              // Столкновение слева или справа
              ball.dx = -ball.dx;
            }
          }
          
          // НОВАЯ СИСТЕМА НАЧИСЛЕНИЯ ГОНОРАРА
          const reward = brick.reward * bonusMultiplier;
          score += reward;
          
          // Создаем эффект текста с наградой
          createRewardText(brick.x + brick.width/2, brick.y + brick.height/2, reward);
          
          bricks.splice(i, 1);
          updateStats();
          break;
        }
      }
      
      // Обновление бонусов
      for (let i = bonuses.length - 1; i >= 0; i--) {
        const bonus = bonuses[i];
        bonus.y += bonus.speed;
        
        if (checkCollision(bonus, paddle)) {
          bonusActive = true;
          bonusMultiplier = 2;
          bonuses.splice(i, 1);
          updateStats();
          setTimeout(() => {
            bonusActive = false;
            bonusMultiplier = 1;
            updateStats();
          }, 10000);
        } else if (bonus.y > canvas.height) {
          bonuses.splice(i, 1);
        }
      }
      
      // Обновление эффектов текста
      updateRewardTexts();
      
      // Проверка завершения уровня
      if (bricks.length === 0) {
        levelComplete();
      }
    }

    // Эффекты текста с наградами
    let rewardTexts = [];
    
    function createRewardText(x, y, amount) {
      rewardTexts.push({
        x: x,
        y: y,
        text: '+' + amount.toLocaleString(),
        alpha: 1,
        life: 60
      });
    }
    
    function updateRewardTexts() {
      for (let i = rewardTexts.length - 1; i >= 0; i--) {
        const text = rewardTexts[i];
        text.y -= 1;
        text.alpha -= 1 / text.life;
        text.life--;
        
        if (text.life <= 0) {
          rewardTexts.splice(i, 1);
        }
      }
    }

    // Отрисовка
    function render() {
      context.clearRect(0, 0, canvas.width, canvas.height);
      
      // Стены
      context.fillStyle = 'rgba(255, 215, 0, 0.3)';
      context.fillRect(0, 0, canvas.width, wallSize);
      context.fillRect(0, 0, wallSize, canvas.height);
      context.fillRect(canvas.width - wallSize, 0, wallSize, canvas.height);
      
      // Кирпичи
      bricks.forEach(brick => {
        context.fillStyle = brick.color;
        context.fillRect(brick.x, brick.y, brick.width, brick.height);
        
        context.fillStyle = brick.textColor;
        context.font = 'bold 8px Arial';
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillText(brick.city, brick.x + brick.width/2, brick.y + brick.height/2);
      });
      
      // Бонусы
      bonuses.forEach(bonus => {
        context.fillStyle = bonus.color;
        context.fillRect(bonus.x, bonus.y, bonus.width, bonus.height);
        
        context.fillStyle = '#000000';
        context.font = 'bold 7px Arial';
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillText(bonus.text, bonus.x + bonus.width/2, bonus.y + bonus.height/2);
      });
      
      // Эффекты текста с наградами
      rewardTexts.forEach(text => {
        context.fillStyle = `rgba(255, 215, 0, ${text.alpha})`;
        context.font = 'bold 12px Arial';
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillText(text.text, text.x, text.y);
      });
      
      // Платформа с надписью PERVUSHIN
      context.fillStyle = '#ffd700';
      context.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
      
      context.fillStyle = '#000000';
      context.font = 'bold 10px Arial';
      context.textAlign = 'center';
      context.textBaseline = 'middle';
      context.fillText('PERVUSHIN', paddle.x + paddle.width/2, paddle.y + paddle.height/2);
      
      // Мяч
      context.fillStyle = '#ffd700';
      context.beginPath();
      context.arc(ball.x + ball.width/2, ball.y + ball.height/2, ball.width/2, 0, Math.PI * 2);
      context.fill();
    }

    // Завершение уровня
    function levelComplete() {
      gameRunning = false;
      document.getElementById('bonusAmount').textContent = score.toLocaleString();
      thanksScreen.style.display = 'block';
    }

    // Конец игры
    function gameOver() {
      gameRunning = false;
      document.getElementById('finalScore').textContent = score.toLocaleString();
      gameOverScreen.style.display = 'block';
    }

    // Перезапуск
    document.getElementById('restartBtn').addEventListener('click', () => {
      score = 0;
      level = 1;
      lives = 3;
      bonusActive = false;
      bonusMultiplier = 1;
      countdown = 5;
      gameOverScreen.style.display = 'none';
      countdownElement.style.display = 'flex';
      countdownElement.textContent = countdown;
      createLevel();
      resetBall();
      updateStats();
      startCountdown();
    });

    // Продолжить
    document.getElementById('continueBtn').addEventListener('click', () => {
      level++;
      thanksScreen.style.display = 'none';
      countdown = 5;
      countdownElement.style.display = 'flex';
      countdownElement.textContent = countdown;
      createLevel();
      resetBall();
      updateStats();
      startCountdown();
    });

    // Изменение размера
    function resizeCanvas() {
      const container = canvas.parentElement;
      const containerWidth = container.clientWidth;
      const aspectRatio = 400 / 500;
      
      canvas.width = containerWidth;
      canvas.height = containerWidth / aspectRatio;
      
      // Позиционируем платформу НИЖЕ
      paddle.y = canvas.height - 30;
      paddle.x = (canvas.width - paddle.width) / 2;
      
      resetBall();
    }

    window.addEventListener('resize', resizeCanvas);

    // Запускаем игру
    initGame();
  </script>
</body>
</html>
